<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>書類作成依頼 アンケートフォーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interフォントの読み込み */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        /* モーダルのためのスタイル */
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-8 sm:p-10 space-y-8">
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800">書類作成依頼 アンケートフォーム</h1>
            <p class="mt-2 text-gray-600">取引先様からの書類作成依頼に関する情報をご入力ください。</p>
        </div>

        <form id="requestForm" class="space-y-10" action="https://formspree.io/f/xpwjwnje" method="POST">
            <!-- 登録支援機関情報 -->
            <fieldset class="space-y-6 border-t pt-6">
                <legend class="text-xl font-semibold text-gray-700 -mt-11 px-2 bg-white">登録支援機関情報</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="orgName" class="block text-sm font-medium text-gray-700 mb-1">1. 登録支援機関名</label>
                        <input type="text" id="orgName" name="orgName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="orgAddress" class="block text-sm font-medium text-gray-700 mb-1">2. 住所</label>
                        <input type="text" id="orgAddress" name="orgAddress" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="orgPhone" class="block text-sm font-medium text-gray-700 mb-1">3. 電話番号</label>
                        <input type="tel" id="orgPhone" name="orgPhone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="orgRegNumber" class="block text-sm font-medium text-gray-700 mb-1">4. 登録支援登録番号</label>
                        <input type="text" id="orgRegNumber" name="orgRegNumber" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="orgRegDate" class="block text-sm font-medium text-gray-700 mb-1">5. 登録支援登録日</label>
                        <input type="date" id="orgRegDate" name="orgRegDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </fieldset>

            <!-- 支援状況 -->
            <fieldset class="space-y-6 border-t pt-6">
                <legend class="text-xl font-semibold text-gray-700 -mt-11 px-2 bg-white">支援状況</legend>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="supportCount" class="block text-sm font-medium text-gray-700 mb-1">6. 現在の支援人数</label>
                        <input type="number" id="supportCount" name="supportCount" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="supportManager" class="block text-sm font-medium text-gray-700 mb-1">7. 支援責任者</label>
                        <input type="text" id="supportManager" name="supportManager" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="supportStaff" class="block text-sm font-medium text-gray-700 mb-1">8. 支援担当者</label>
                        <input type="text" id="supportStaff" name="supportStaff" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </fieldset>

            <!-- 依頼内容 -->
            <fieldset class="space-y-6 border-t pt-6">
                <legend class="text-xl font-semibold text-gray-700 -mt-11 px-2 bg-white">依頼内容</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">9. 依頼元企業名</label>
                        <input type="text" id="clientName" name="clientName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="applicantName" class="block text-sm font-medium text-gray-700 mb-1">10. 申請者名</label>
                        <input type="text" id="applicantName" name="applicantName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="applicantNationality" class="block text-sm font-medium text-gray-700 mb-1">11. 申請者国籍</label>
                        <input type="text" id="applicantNationality" name="applicantNationality" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">12. 今回対応する在留資格</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center"><input type="radio" name="visaType" value="認定" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" checked> <span class="ml-2">認定</span></label>
                            <label class="flex items-center"><input type="radio" name="visaType" value="変更" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300"> <span class="ml-2">変更</span></label>
                            <label class="flex items-center"><input type="radio" name="visaType" value="更新" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300"> <span class="ml-2">更新</span></label>
                        </div>
                    </div>
                    <div>
                        <label for="supportFee" class="block text-sm font-medium text-gray-700 mb-1">13. 支援料</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">¥</span>
                            <input type="number" id="supportFee" name="supportFee" class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                    <div>
                        <label for="contractDate" class="block text-sm font-medium text-gray-700 mb-1">14. 支援委託契約書の締結日</label>
                        <input type="date" id="contractDate" name="contractDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">15. 支援委託契約期間</label>
                        <div class="flex items-center space-x-2">
                            <input type="date" id="contractStartDate" name="contractStartDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <span>～</span>
                            <input type="date" id="contractEndDate" name="contractEndDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                    <div>
                        <label for="deadline" class="block text-sm font-medium text-gray-700 mb-1">16. 〆切</label>
                        <input type="date" id="deadline" name="deadline" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">17. 申請方法</label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="applicationMethod" value="オンライン" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" checked>
                                <span class="ml-2">オンライン</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="applicationMethod" value="窓口申請" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                <span class="ml-2">窓口申請</span>
                            </label>
                        </div>
                        <!-- オンライン選択時の追加項目 -->
                        <div id="onlineOptions" class="hidden mt-4 space-y-4">
                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">依頼範囲</label>
                                <div class="flex items-center space-x-4">
                                    <label class="flex items-center">
                                        <input type="radio" name="onlineScope" value="申請までを依頼" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300">
                                        <span class="ml-2">申請までを依頼</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="onlineScope" value="書類作成のみ" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" checked>
                                        <span class="ml-2">書類作成のみ</span>
                                    </label>
                                </div>
                            </div>
                            <!-- ID and Password fields -->
                            <div id="onlineCredentials" class="hidden space-y-2">
                                <div>
                                    <label for="onlineId" class="block text-sm font-medium text-gray-700 mb-1">オンライン申請ID</label>
                                    <input type="text" id="onlineId" name="onlineId" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="onlinePw" class="block text-sm font-medium text-gray-700 mb-1">パスワード</label>
                                    <input type="password" id="onlinePw" name="onlinePw" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">18. 在留カードの受取方法 <span class="text-xs text-gray-500">※認定申請を除く</span></label>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center"><input type="radio" name="cardReceipt" value="郵送" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" checked> <span class="ml-2">郵送</span></label>
                            <label class="flex items-center"><input type="radio" name="cardReceipt" value="入管で直接受取" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300"> <span class="ml-2">入管で直接受取</span></label>
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- 窓口担当者情報 -->
            <fieldset class="space-y-6 border-t pt-6">
                <legend class="text-xl font-semibold text-gray-700 -mt-11 px-2 bg-white">窓口担当者情報</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="contactName" class="block text-sm font-medium text-gray-700 mb-1">19. 窓口担当者名</label>
                        <input type="text" id="contactName" name="contactName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">20. 窓口担当者連絡先</label>
                        <div class="flex items-center space-x-4 mb-2">
                            <label class="flex items-center"><input type="radio" name="contactMethod" value="電話" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300" checked> <span class="ml-2">電話</span></label>
                            <label class="flex items-center"><input type="radio" name="contactMethod" value="LINE" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300"> <span class="ml-2">LINE</span></label>
                        </div>
                        <input type="text" id="contactDetail" name="contactDetail" placeholder="電話番号を入力" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </fieldset>

            <!-- 送信ボタン -->
            <div class="text-center pt-6">
                <button type="submit" class="w-full md:w-auto bg-indigo-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-300">
                    送信
                </button>
            </div>
        </form>
    </div>

    <!-- 結果表示モーダル -->
    <div id="resultModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-backdrop">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-8 modal-content transform scale-95">
            <div class="flex justify-between items-center border-b pb-4">
                <h2 class="text-2xl font-bold text-gray-800">入力内容の確認</h2>
                <button id="closeModal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="modalContent" class="mt-6 space-y-4 text-gray-700">
                <!-- 結果がここに表示されます -->
            </div>
            <div class="mt-8 text-right">
                 <button id="closeModalFooter" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors duration-300">
                    閉じる
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // フォームとモーダルの要素を取得
            const form = document.getElementById('requestForm');
            const contactMethodRadios = document.querySelectorAll('input[name="contactMethod"]');
            const contactDetailInput = document.getElementById('contactDetail');
            const resultModal = document.getElementById('resultModal');
            const modalContent = document.getElementById('modalContent');
            const closeModalButton = document.getElementById('closeModal');
            const closeModalFooterButton = document.getElementById('closeModalFooter');
            
            const applicationMethodRadios = document.querySelectorAll('input[name="applicationMethod"]');
            const onlineOptionsDiv = document.getElementById('onlineOptions');
            const onlineScopeRadios = document.querySelectorAll('input[name="onlineScope"]');
            const onlineCredentialsDiv = document.getElementById('onlineCredentials');

            // 連絡先のプレースホルダーを動的に変更する処理
            contactMethodRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.value === 'LINE') {
                        contactDetailInput.placeholder = 'LINE IDを入力';
                    } else {
                        contactDetailInput.placeholder = '電話番号を入力';
                    }
                });
            });

            // オンライン申請のサブオプション表示を制御する関数
            const toggleOnlineOptions = () => {
                const selectedMethod = document.querySelector('input[name="applicationMethod"]:checked').value;
                if (selectedMethod === 'オンライン') {
                    onlineOptionsDiv.classList.remove('hidden');
                    toggleOnlineCredentials(); // 依頼範囲の選択状態に応じてID/PW欄の表示も更新
                } else {
                    onlineOptionsDiv.classList.add('hidden');
                    onlineCredentialsDiv.classList.add('hidden'); // オンラインでないならID/PW欄も隠す
                }
            };

            // オンライン申請のID/PW欄の表示を制御する関数
            const toggleOnlineCredentials = () => {
                if (document.querySelector('input[name="applicationMethod"]:checked').value === 'オンライン') {
                    const selectedScope = document.querySelector('input[name="onlineScope"]:checked').value;
                    if (selectedScope === '申請までを依頼') {
                        onlineCredentialsDiv.classList.remove('hidden');
                    } else {
                        onlineCredentialsDiv.classList.add('hidden');
                    }
                }
            };

            // イベントリスナーを設定
            applicationMethodRadios.forEach(radio => radio.addEventListener('change', toggleOnlineOptions));
            onlineScopeRadios.forEach(radio => radio.addEventListener('change', toggleOnlineCredentials));

            // ページ読み込み時に初期状態を設定
            toggleOnlineOptions();

            // フォーム送信時の処理
            form.addEventListener('submit', function (event) {
                event.preventDefault(); // デフォルトの送信をキャンセル

                const formData = new FormData(form);
                let contentHTML = '<dl class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4">';

                const labels = {
                    orgName: '1. 登録支援機関名',
                    orgAddress: '2. 住所',
                    orgPhone: '3. 電話番号',
                    orgRegNumber: '4. 登録支援登録番号',
                    orgRegDate: '5. 登録支援登録日',
                    supportCount: '6. 現在の支援人数',
                    supportManager: '7. 支援責任者',
                    supportStaff: '8. 支援担当者',
                    clientName: '9. 依頼元企業名',
                    applicantName: '10. 申請者名',
                    applicantNationality: '11. 申請者国籍',
                    visaType: '12. 対応在留資格',
                    supportFee: '13. 支援料',
                    contractDate: '14. 契約締結日',
                    contractPeriod: '15. 契約期間',
                    deadline: '16. 〆切',
                    applicationMethod: '17. 申請方法',
                    onlineScope: '依頼範囲',
                    onlineId: 'オンライン申請ID',
                    onlinePw: 'パスワード',
                    cardReceipt: '18. 在留カード受取方法',
                    contactName: '19. 窓口担当者名',
                    contactMethod: '20. 連絡先種別',
                    contactDetail: '20. 連絡先詳細',
                };
                
                // 契約期間を結合
                const contractStart = formData.get('contractStartDate');
                const contractEnd = formData.get('contractEndDate');
                const contractPeriod = (contractStart && contractEnd) ? `${contractStart} ～ ${contractEnd}` : '未入力';

                // FormDataの各エントリをループして表示
                for (let [key, value] of formData.entries()) {
                    // 契約期間の個別フィールドはスキップ
                    if (key === 'contractStartDate' || key === 'contractEndDate') continue;

                    // 条件に応じて不要な項目をモーダルに表示しない
                    const applicationMethod = formData.get('applicationMethod');
                    if (applicationMethod !== 'オンライン' && ['onlineScope', 'onlineId', 'onlinePw'].includes(key)) {
                        continue;
                    }
                    const onlineScope = formData.get('onlineScope');
                    if (onlineScope !== '申請までを依頼' && ['onlineId', 'onlinePw'].includes(key)) {
                        continue;
                    }

                    const label = labels[key] || key;
                    let displayValue = value ? value : '未入力';

                    // パスワードは表示しない
                    if (key === 'onlinePw' && value) {
                        displayValue = '********';
                    }

                    contentHTML += `
                        <dt class="font-semibold text-gray-800 md:col-span-1">${label}</dt>
                        <dd class="text-gray-600 md:col-span-2">${displayValue}</dd>
                    `;
                }
                
                // 結合した契約期間を追加
                contentHTML += `
                    <dt class="font-semibold text-gray-800 md:col-span-1">${labels.contractPeriod}</dt>
                    <dd class="text-gray-600 md:col-span-2">${contractPeriod}</dd>
                `;

                contentHTML += '</dl>';
                modalContent.innerHTML = contentHTML;

                // モーダルを表示
                resultModal.classList.remove('hidden');
                setTimeout(() => {
                    resultModal.querySelector('.modal-content').classList.remove('scale-95');
                    resultModal.classList.remove('opacity-0');
                }, 10);

                // Formspreeへの非同期送信
                fetch(form.action, {
                    method: form.method,
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                }).then(response => {
                    if (response.ok) {
                        console.log('フォームは正常に送信されました。');
                        // ここで成功メッセージをモーダル内に表示することも可能
                    } else {
                        response.json().then(data => {
                            if (Object.hasOwn(data, 'errors')) {
                                console.error(data["errors"].map(error => error["message"]).join(", "));
                            } else {
                                console.error('フォームの送信中にエラーが発生しました。');
                            }
                        })
                    }
                }).catch(error => {
                    console.error('ネットワークエラー:', error);
                });
            });

            // モーダルを閉じる関数
            const closeModal = () => {
                resultModal.querySelector('.modal-content').classList.add('scale-95');
                resultModal.classList.add('opacity-0');
                setTimeout(() => {
                    resultModal.classList.add('hidden');
                }, 300);
            };

            // 閉じるボタンのイベントリスナー
            closeModalButton.addEventListener('click', closeModal);
            closeModalFooterButton.addEventListener('click', closeModal);
            resultModal.addEventListener('click', (e) => {
                if (e.target === resultModal) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
